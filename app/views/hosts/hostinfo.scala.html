@(knownHost: uk.bl.monitrix.model.KnownHost, logEntries: List[uk.bl.monitrix.model.CrawlLogEntry])

@import tags.{heritrixStatus, navbar}

@main("Monitrix - Host Information") {
  @navbar("")
}{
  @defining(uk.bl.monitrix.analytics.LogAnalytics.getFetchStatusDistribution(logEntries.iterator)) { httpCodes =>
    <h1 style="padding:0px 0px 10px 5px;"><a href="http://@knownHost.getHostname()" target="_blank">@knownHost.getHostname()</a></h1>
    <table class="table monitrix-hostinfo">
      <tr><td class="monitrix-hostinfo-label">First Accessed</td><td colspan="2">@{new Date(knownHost.getFirstAccess()).format("dd MMM yy, HH:mm")}</td></tr>
      <tr><td class="monitrix-hostinfo-label">Last Accessed</td><td colspan="2">@{new Date(knownHost.getLastAccess()).format("dd MMM yy, HH:mm")}</td></tr>
      <tr><td class="monitrix-hostinfo-label">No. Crawled URLs</td><td colspan="2">@logEntries.size</td></tr>
      <tr>
        <td class="monitrix-hostinfo-label">HTTP Results</td>
        <td style="vertical-align:middle; width:300px;"><div id="chart"></div></td>
        <td style="vertical-align:middle; padding-right:50px;">
          <small>
            <table class="table table-condensed table-striped" style="text-align:left;">
              <thead>
                <tr><th># of URLs</th><th>%</th><th>Result</th><th>Code</th></tr>
              </thead>
              <tbody>
              @defining(httpCodes.map(_.getValue()).foldLeft(0l)(_ + _)) { sum =>
                @for(result <- httpCodes.sortWith(_.getValue() > _.getValue())) {
                  <tr><td>@result.getValue()</td><td>@{(result.getValue() * 100) / sum}</td><td>@heritrixStatus(result.getLabel())</td><td>@result.getLabel()</td></tr>
                }
              }
              </tbody>
            </table>
          </small>
        </td>
      </tr>
      <tr>
        <td class="monitrix-hostinfo-label">Virus Check</td>
        <td colspan="2">
          <div id="chart-viruscheck"></div>
        </td>
      </tr>
      @defining(uk.bl.monitrix.analytics.LogAnalytics.getCrawlerIDs(logEntries.iterator)) { crawlers =>
        <tr><td class="monitrix-hostinfo-label">Crawlers (@crawlers.size())</td><td colspan="2">@crawlers.mkString(", ")</td></tr>
      }
    </table>
  
    <script src="@routes.Assets.at("javascripts/monitrix-piechart.js")" type="text/javascript"></script>
    <script>
      window.onload = function() {
        new Monitrix.PieChart(
    	      240, 240, 100,
              [
    		    @{httpCodes.map(code =>
    		      "{'label':'" + code.getLabel() + "','value':" + code.getValue()  + "}" 
    		    ).mkString(", ") }
              ],
    		  'chart');
        
        new Monitrix.PieChart(
      	      240, 240, 100,
                [
      		    @{uk.bl.monitrix.analytics.LogAnalytics.getVirusDistribution(logEntries.iterator).map(code =>
      		      "{'label':'" + code.getLabel() + "','value':" + code.getValue()  + "}" 
      		    ).mkString(", ") }
                ],
      		  'chart-viruscheck');
      }
    </script>
  }
}