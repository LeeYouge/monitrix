@(log: uk.bl.monitrix.model.CrawlLog)

@import tags.{heritrixStatus, navbar}

@main("Monitrix - URLs") {
  @navbar("/urls")
}{
  <h2>Total URLs: @log.countEntries</h2>
  <h3>Revisited: @log.searchByAnnotation("warcRevisit:digest", 1, 0).totalResults</h3>
  
  <table class="table monitrix-hostinfo">
    <tr>
      <td class="monitrix-hostinfo-label">Compressability</td>
      <td><div style="height:220px;" id="compressability-histogram"></div></td>
    </tr>
  </table>
  
  <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/morris.css")">
  <script src="@routes.Assets.at("javascripts/raphael-min.js")" type="text/javascript"></script>
  <script src="@routes.Assets.at("javascripts/morris.min.js")" type="text/javascript"></script>  
  <script>
    // Compressability is a value between 0 (theoretical - i.e. 'compressed to 0) and 1 (not compressable)
    Morris.Bar({
      element: 'compressability-histogram',
      data: [
            @{Seq.range(0, 100).map(_ * 0.01).map { c =>
              "{ compressability: " + c + ", count: " + hosts.searchByAverageFetchDuration(startValue, startValue + increment, 1, 0).totalResults + "}" 
            }.mkString(", ") }
        ],
      xkey: 'compressability',
      ykeys: ['count'],
      labels: [ '# of Hosts' ],
      hideHover: 'false',
      barColors: [ '#850303' ],
    });
  </script>
}